<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> SQ와 프로소디 간 상관관계 연구 | SoulSpectrum</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

    <section id="step1" class="step active">
        <h2 class="title">프로젝트-RHYTHME</h2>
        <div class="research-intro">
            <p>본 연구는 <strong>(주)소울스펙트럼(SoulSpectrum Inc.)</strong>에서 주관하며, 
            음성 특징과 SQ(Systemizing Quotient)의 상관관계를 분석하여 신경다양성 특성을 정밀 프로파일링하는 것을 목적으로 합니다.</p>
            <p class="pi-info">연구책임자: 맹난영</p>
        </div>
        <div class="button-group" style="margin-top: 40px;">
            <button class="next-btn" onclick="startResearch(false)">14세 이상 연구 참여하기</button>
            <button class="next-btn secondary-btn" style="margin-top: 16px;" onclick="startResearch(true)">
                14세 미만 연구 참여하기 (보호자 동의 필요)
            </button>
        </div>
    </section>

    <section id="step2" class="step">
        <h3 class="title">연구 참여 동의</h3>
        <div class="consent-group">
            <div class="consent-item" id="parentalConsentItem" style="display: none;">
                <div class="consent-header" onclick="loadAndToggleConsent('child.txt', this)">
                    <input type="checkbox" class="essential" id="checkParent" onclick="event.stopPropagation()">
                    <div class="header-text"><span class="subject">법정대리인 동의</span><span class="badge">필수</span></div>
                    <span class="arrow">▼</span>
                </div>
                <div class="consent-content"><div class="consent-text-area">내용을 불러오는 중...</div></div>
            </div>
            </div>
        <button class="next-btn" onclick="checkAndGo()">동의 완료 및 다음</button>
    </section>

    <section id="step3" class="step">
        <h3 class="title">기본 정보 입력</h3>
        <button class="next-btn" style="margin-top: 40px;" onclick="validateStep3()">체계화 지수 SQ 테스트 시작</button>
    </section>

    <section id="step4" class="step">
        <div id="questionCount" class="step-indicator">1 / 10</div>
        <h3 id="questionText" class="question-title"></h3>
        <div class="answer-group">
            <button class="ans-btn" onclick="handleAnswer(0)">전혀 아니다</button>
            <button class="ans-btn" onclick="handleAnswer(1)">약간 그렇다</button>
            <button class="ans-btn" onclick="handleAnswer(2)">상당히 그렇다</button>
            <button class="ans-btn" onclick="handleAnswer(3)">매우 그렇다</button>
        </div>
    </section>

    <section id="step5" class="step">
        <h3 class="title">qEEG 업로드 (선택)</h3>
        <button class="next-btn" style="margin-top: 40px;" onclick="submitAll()">음성 분석 안내로 이동</button>
    </section>

    <section id="step6" class="step">
        <h3 class="title">음성 분석 테스트 안내</h3>
        <div class="intro-box">
            <p class="description">지금부터 목소리를 통한 심리 반응 테스트를 시작합니다.</p>
            <ul class="guide-list">
                <li>📍 각 문항은 최대 40초간 진행됩니다.</li>
                <li>📍 질문을 읽고 준비가 되면 녹음 시작을 눌러주세요.</li>
            </ul>
        </div>
        <button class="next-btn" onclick="goToVoiceTest()">확인했습니다</button>
    </section>

    <section id="step7" class="step" style="display:none;">
        <div class="stage-info">
            <span id="stageBadge">Stage 1</span>
            <h3 id="question" class="voice-title">지문을 불러오는 중...</h3>
            <p id="desc" class="voice-desc"></p>
        </div>
        <div class="recorder-wrapper">
            <svg width="200" height="200" viewBox="0 0 100 100">
                <circle class="timer-bg" cx="50" cy="50" r="45" fill="none" stroke="#333" stroke-width="2" />
                <circle id="timerLine" cx="50" cy="50" r="45" fill="none" stroke="#BB86FC" 
                        stroke-width="4" stroke-dasharray="283" stroke-dashoffset="0" 
                        transform="rotate(-90 50 50)" style="transition: all 0.1s linear;" />
            </svg>
            <div id="timer">40s</div>
            <button id="recordBtn" class="record-btn">
                <div id="recordIcon"></div>
                <span>녹음 시작</span>
            </button>
        </div>
        <button id="nextBtn" class="next-btn" style="display:none;">다음 단계로</button>
    </section>

    <div id="customModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-body"><p id="modalMessage"></p></div>
            <button onclick="closeModal()" class="modal-btn">확인</button>
        </div>
    </div>
</div>

<script type="module" src="voice-processor.js"></script>
<script type="module" src="voice-ui.js"></script>
<script type="module" src="app.js"></script>
</body>
</html>